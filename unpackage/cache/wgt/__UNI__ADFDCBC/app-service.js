if("undefined"==typeof Promise||Promise.prototype.finally||(Promise.prototype.finally=function(e){const t=this.constructor;return this.then((a=>t.resolve(e()).then((()=>a))),(a=>t.resolve(e()).then((()=>{throw a}))))}),"undefined"!=typeof uni&&uni&&uni.requireGlobal){const e=uni.requireGlobal();ArrayBuffer=e.ArrayBuffer,Int8Array=e.Int8Array,Uint8Array=e.Uint8Array,Uint8ClampedArray=e.Uint8ClampedArray,Int16Array=e.Int16Array,Uint16Array=e.Uint16Array,Int32Array=e.Int32Array,Uint32Array=e.Uint32Array,Float32Array=e.Float32Array,Float64Array=e.Float64Array,BigInt64Array=e.BigInt64Array,BigUint64Array=e.BigUint64Array}uni.restoreGlobal&&uni.restoreGlobal(Vue,weex,plus,setTimeout,clearTimeout,setInterval,clearInterval),function(e){"use strict";function t(e,t,...a){uni.__log__?uni.__log__(e,t,...a):console[e].apply(console,[...a,t])}const a=new class{constructor(){this.db=null,this.isReady=!1}async initDatabase(){return new Promise(((e,t)=>{if("undefined"==typeof plus||!plus.sqlite||!plus.sqlite.openDatabase)return this.isReady=!1,void e();plus.sqlite.closeDatabase({name:"workApp",success:()=>this.openDatabase(e,t),fail:()=>this.openDatabase(e,t)})}))}openDatabase(e,t){plus.sqlite.openDatabase({name:"workApp",path:"_doc/workApp.db",success:()=>{this.db=plus.sqlite,this.isReady=!0,this.createTables().then(e).catch((()=>{this.isReady=!1,e()}))},fail:t=>{if(-1402===t.code)return this.db=plus.sqlite,this.isReady=!0,void this.createTables().then(e).catch((()=>{this.isReady=!1,e()}));this.isReady=!1,e()}})}async createTables(){return new Promise(((e,t)=>{if(!this.isReady)return void t(new Error("æ•°æ®åº“æœªè¿æ¥"));plus.sqlite.selectSql({name:"workApp",sql:"SELECT name FROM sqlite_master WHERE type='table' AND name='work_records'",success:a=>{if(a.length>0)return void e();plus.sqlite.executeSql({name:"workApp",sql:"\n            CREATE TABLE work_records (\n              id INTEGER PRIMARY KEY AUTOINCREMENT,\n              date TEXT NOT NULL,\n              quantity REAL NOT NULL,\n              unit_price REAL NOT NULL,\n              total REAL NOT NULL,\n              created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n              updated_at DATETIME DEFAULT CURRENT_TIMESTAMP\n            )\n          ",success:e,fail:t})},fail:t})}))}async insertWorkRecord(e){return new Promise(((a,s)=>{if(!this.isReady)return void s(new Error("æ•°æ®åº“æœªåˆå§‹åŒ–ï¼Œæ— æ³•ä¿å­˜è®°å½•"));if(t("log","at utils/database.js:102","=== DEBUG: database.js insertWorkRecord ==="),!e.date||null===e.date||void 0===e.date||""===e.date)return void s(new Error("æ—¥æœŸä¸èƒ½ä¸ºç©º"));const o=e.date.toString();if(!/^\d{4}-\d{2}-\d{2}$/.test(o))return void s(new Error("æ—¥æœŸæ ¼å¼å¿…é¡»ä¸ºYYYY-MM-DD"));if(void 0===e.quantity||null===e.quantity||isNaN(e.quantity))return void s(new Error("æ•°é‡ä¸èƒ½ä¸ºç©ºä¸”å¿…é¡»ä¸ºæ•°å­—"));if(void 0===e.unitPrice||null===e.unitPrice||isNaN(e.unitPrice))return void s(new Error("å•ä»·ä¸èƒ½ä¸ºç©ºä¸”å¿…é¡»ä¸ºæ•°å­—"));if(void 0===e.total||null===e.total||isNaN(e.total))return void s(new Error("æ€»é‡‘é¢ä¸èƒ½ä¸ºç©ºä¸”å¿…é¡»ä¸ºæ•°å­—"));const r=o&&""!==o.trim()?o:"2024-01-01",i=parseFloat(e.quantity),n=parseFloat(e.unitPrice),l=parseFloat(e.total);if(t("log","at utils/database.js:139","å®‰å…¨å€¼:",{safeDate:r,safeQuantity:i,safeUnitPrice:n,safeTotal:l}),isNaN(i)||i<=0)return void s(new Error("æ•°é‡å¿…é¡»ä¸ºæ­£æ•°"));if(isNaN(n)||n<=0)return void s(new Error("å•ä»·å¿…é¡»ä¸ºæ­£æ•°"));if(isNaN(l)||l<=0)return void s(new Error("æ€»é‡‘é¢å¿…é¡»ä¸ºæ­£æ•°"));const c=`INSERT INTO work_records (date, quantity, unit_price, total) VALUES ('${r}', ${i}, ${n}, ${l})`;t("log","at utils/database.js:159","ç›´æ¥SQL:",c),plus.sqlite.executeSql({name:"workApp",sql:c,success:e=>{t("log","at utils/database.js:165","âœ“ è®°å½•ä¿å­˜æˆåŠŸï¼ŒID:",e.insertId),a(e.insertId)},fail:e=>{t("error","at utils/database.js:169","âœ— ä¿å­˜è®°å½•å¤±è´¥:",e),t("error","at utils/database.js:170","é”™è¯¯è¯¦æƒ…:",e.code,e.message),t("error","at utils/database.js:171","å¤±è´¥SQL:",c),this.debugTableState().then((()=>{s(e)})).catch((()=>{s(e)}))}})}))}async getAllWorkRecords(){return new Promise(((e,a)=>{t("log","at utils/database.js:186","=== æŸ¥è¯¢æ‰€æœ‰è®°å½• ===");const s=uni.getStorageSync("workRecords")||[],o="SELECT * FROM work_records ORDER BY date DESC, created_at DESC";t("log","at utils/database.js:190","æ‰§è¡Œ SQL:",o),plus.sqlite.selectSql({name:"workApp",sql:o,success:a=>{const s=a.map((e=>({id:e.id,date:e.date,quantity:e.quantity,unitPrice:e.unit_price,total:e.total,createdAt:e.created_at})));t("log","at utils/database.js:204","è½¬æ¢åçš„è®°å½•:",JSON.stringify(s)),e(s)},fail:a=>{t("error","at utils/database.js:208","æŸ¥è¯¢è®°å½•å¤±è´¥:",a),e(s)}})}))}async getWorkRecordsByDateRange(e,a){return new Promise(((s,o)=>{if(!this.isReady)return void o(new Error("æ•°æ®åº“æœªåˆå§‹åŒ–"));const r=`SELECT * FROM work_records WHERE date BETWEEN '${e}' AND '${a}' ORDER BY date DESC`;plus.sqlite.selectSql({name:"workApp",sql:r,values:[e,a],success:e=>{t("log","at utils/database.js:230","æŸ¥è¯¢ç»“æœ:",e);const a=e.map((e=>({id:e.id,date:e.date,quantity:e.quantity,unitPrice:e.unit_price,total:e.total})));s(a)},fail:o})}))}async getStatistics(){return new Promise(((e,t)=>{if(!this.isReady)return void t(new Error("æ•°æ®åº“æœªåˆå§‹åŒ–"));plus.sqlite.selectSql({name:"workApp",sql:"\n        SELECT \n          COUNT(*) as total_records,\n          SUM(quantity) as total_quantity,\n          SUM(total) as total_amount,\n          AVG(unit_price) as avg_price\n        FROM work_records\n      ",success:t=>{if(t.length>0){const a=t[0];e({totalRecords:a.total_records||0,totalQuantity:a.total_quantity||0,totalAmount:a.total_amount||0,avgPrice:a.avg_price||0})}else e({totalRecords:0,totalQuantity:0,totalAmount:0,avgPrice:0})},fail:t})}))}async deleteWorkRecord(e){return new Promise((async(a,s)=>{if(t("log","at utils/database.js:290","=== å¼€å§‹åˆ é™¤è®°å½• ID:",e,"ç±»å‹:",typeof e),!this.isReady)return t("error","at utils/database.js:292","æ•°æ®åº“æœªåˆå§‹åŒ–"),void s(new Error("æ•°æ®åº“æœªåˆå§‹åŒ–"));const o=Number(e);if(!Number.isInteger(o)||o<=0)return t("error","at utils/database.js:298","æ— æ•ˆçš„ ID:",e),void s(new Error(`æ— æ•ˆçš„ ID: ${e}`));try{await this.debugTableData(),t("log","at utils/database.js:304","æ•°æ®åº“è·¯å¾„:",plus.io.convertLocalFileSystemURL("_doc/workApp.db")),plus.sqlite.transaction({name:"workApp",operation:"begin",success:()=>{t("log","at utils/database.js:309","äº‹åŠ¡å¼€å§‹");const e=`SELECT id FROM work_records WHERE id = ${o}`;t("log","at utils/database.js:311","æ£€æŸ¥ SQL:",e),plus.sqlite.selectSql({name:"workApp",sql:e,success:e=>{if(t("log","at utils/database.js:316","æ£€æŸ¥ç»“æœ:",JSON.stringify(e)),0===e.length)return t("log","at utils/database.js:318",`è®°å½• ID ${o} ä¸å­˜åœ¨`),void plus.sqlite.transaction({name:"workApp",operation:"commit",success:()=>{t("log","at utils/database.js:323","äº‹åŠ¡æäº¤ï¼šè®°å½•ä¸å­˜åœ¨"),a(0)},fail:e=>{t("error","at utils/database.js:327","æäº¤äº‹åŠ¡å¤±è´¥:",e),s(e)}});const r=`DELETE FROM work_records WHERE id = ${o}`;t("log","at utils/database.js:334","åˆ é™¤ SQL:",r),plus.sqlite.executeSql({name:"workApp",sql:r,success:e=>{t("log","at utils/database.js:339","åˆ é™¤ç»“æœ:",JSON.stringify(e));const r=e.rowsAffected||0;t("log","at utils/database.js:341","âœ“ è®°å½•åˆ é™¤æˆåŠŸï¼Œå½±å“è¡Œæ•°:",r),plus.sqlite.selectSql({name:"workApp",sql:`SELECT id FROM work_records WHERE id = ${o}`,success:e=>{t("log","at utils/database.js:346","åˆ é™¤åæ£€æŸ¥:",JSON.stringify(e)),plus.sqlite.transaction({name:"workApp",operation:"commit",success:()=>{if(t("log","at utils/database.js:351","äº‹åŠ¡æäº¤ï¼šåˆ é™¤å®Œæˆ"),r>0){const e=(uni.getStorageSync("workRecords")||[]).filter((e=>e.id!==o));uni.setStorageSync("workRecords",e),t("log","at utils/database.js:356","ç¼“å­˜å·²æ›´æ–°:",JSON.stringify(e))}a(r)},fail:e=>{t("error","at utils/database.js:361","æäº¤äº‹åŠ¡å¤±è´¥:",e),s(e)}})},fail:e=>{t("error","at utils/database.js:367","åˆ é™¤åæ£€æŸ¥å¤±è´¥:",e),s(e)}})},fail:e=>{t("error","at utils/database.js:373","âœ— åˆ é™¤è®°å½•å¤±è´¥:",e),plus.sqlite.transaction({name:"workApp",operation:"rollback",success:()=>{t("log","at utils/database.js:378","äº‹åŠ¡å›æ»š"),s(e)},fail:e=>{t("error","at utils/database.js:382","å›æ»šäº‹åŠ¡å¤±è´¥:",e),s(e)}})}})},fail:e=>{t("error","at utils/database.js:390","æ£€æŸ¥è®°å½•å¤±è´¥:",e),plus.sqlite.transaction({name:"workApp",operation:"rollback",success:()=>{t("log","at utils/database.js:395","äº‹åŠ¡å›æ»š"),s(e)},fail:e=>{t("error","at utils/database.js:399","å›æ»šäº‹åŠ¡å¤±è´¥:",e),s(e)}})}})},fail:e=>{t("error","at utils/database.js:407","å¼€å¯äº‹åŠ¡å¤±è´¥:",e),s(e)}})}catch(r){t("error","at utils/database.js:412","åˆ é™¤æ“ä½œå¼‚å¸¸:",r),s(r)}}))}async debugTableData(){return new Promise(((e,a)=>{t("log","at utils/database.js:420","=== è°ƒè¯•æ•°æ®åº“å†…å®¹ ===");plus.sqlite.selectSql({name:"workApp",sql:"SELECT * FROM work_records",success:a=>{t("log","at utils/database.js:426","æ•°æ®åº“ä¸­æ‰€æœ‰è®°å½•:",JSON.stringify(a)),e(a)},fail:e=>{t("error","at utils/database.js:430","æŸ¥è¯¢æ‰€æœ‰è®°å½•å¤±è´¥:",e),a(e)}})}))}async updateWorkRecord(e,t){return new Promise(((a,s)=>{if(!this.isReady)return void s(new Error("æ•°æ®åº“æœªåˆå§‹åŒ–"));const o=[t.date,t.quantity,t.unitPrice,t.total,e];plus.sqlite.executeSql({name:"workApp",sql:"UPDATE work_records SET date = ?, quantity = ?, unit_price = ?, total = ?, updated_at = CURRENT_TIMESTAMP WHERE id = ?",values:o,success:()=>a(),fail:s})}))}isInitialized(){return this.isReady}async migrateFromCache(){return new Promise((async(e,t)=>{if(this.isInitialized())try{const t=uni.getStorageSync("workRecords")||[];if(0===t.length)return void e(0);let a=0;for(const e of t)try{await this.insertWorkRecord({date:e.date,quantity:e.quantity,unitPrice:e.unitPrice,total:e.total}),a++}catch{}e(a)}catch(a){t(a)}else e(0)}))}clearCache(){uni.removeStorageSync("workRecords")}async test(){return new Promise(((e,t)=>{if(!this.isReady)return void t(new Error("æ•°æ®åº“æœªåˆå§‹åŒ–"));plus.sqlite.selectSql({name:"workApp",sql:"SELECT * FROM work_records WHERE date >= '2025-10-01' AND date <= '2025-10-31';",success:t=>{const a=t.map((e=>({id:e.id,date:e.date,quantity:e.quantity,unitPrice:e.unit_price,total:e.total})));e(a)},fail:t})}))}};async function s(){return new Promise((e=>{"undefined"!=typeof plus&&plus.sqlite?a.initDatabase().then((()=>{a.migrateFromCache().then((t=>{t>0&&a.clearCache(),e()})).catch(e)})).catch(e):e()}))}const o=(e,t)=>{const a=e.__vccOpts||e;for(const[s,o]of t)a[s]=o;return a};const r=o({components:{MonthlyStats:o({props:{year:{type:Number,required:!0},month:{type:Number,required:!0},showStats:{type:Boolean,default:!1}},data:()=>({workDays:0,dailyAverage:0,maxDaily:0,totalRecords:0,total_1_10:0,total_11_20:0,total_21_max:0,dbReady:!1}),async mounted(){try{await s(),this.dbReady=!0}catch(e){t("warn","at components/MonthlyStats.vue:83","æ•°æ®åº“åˆå§‹åŒ–å¤±è´¥"),this.dbReady=!0}},watch:{year(){this.calculateStats()},month(){this.calculateStats()},showStats(e){e&&this.calculateStats()}},methods:{formatAmount(e){const t=parseFloat(e);return Number.isInteger(t)?t.toString():t.toFixed(3).replace(/\.?0+$/,"")},async calculateStats(){t("log","at components/MonthlyStats.vue:109","=== è®¡ç®—æœ¬æœˆç»Ÿè®¡ ==="),t("log","at components/MonthlyStats.vue:110","å¹´ä»½:",this.year,"æœˆä»½:",this.month);try{let e=[];if(!0===this.dbReady){t("log","at components/MonthlyStats.vue:116","ä½¿ç”¨æ•°æ®åº“æŸ¥è¯¢");const s=`${this.year}-${String(this.month).padStart(2,"0")}-01`,o=new Date(this.year,this.month,0).getDate(),r=`${this.year}-${String(this.month).padStart(2,"0")}-${String(o).padStart(2,"0")}`;e=await a.getWorkRecordsByDateRange(s,r)}else t("log","at components/MonthlyStats.vue:123","æ•°æ®åº“ä¸å¯ç”¨"),e=[];t("log","at components/MonthlyStats.vue:127","æœ¬æœˆè®°å½•æ•°:",e.length);const s={};e.forEach((e=>{const t=e.date;s[t]||(s[t]=[]),s[t].push(e)})),this.workDays=Object.keys(s).length,this.totalRecords=e.length;const o=Object.values(s).map((e=>e.reduce(((e,t)=>e+parseFloat(t.total||0)),0)));if(o.length>0){const e=o.reduce(((e,t)=>e+t),0);this.dailyAverage=this.formatAmount(e/o.length),this.maxDaily=this.formatAmount(Math.max(...o))}else this.dailyAverage="0",this.maxDaily="0";const r={};Object.entries(s).forEach((([e,t])=>{const a=parseInt(e.split("-")[2]),s=t.reduce(((e,t)=>e+parseFloat(t.total||0)),0);r[a]=s})),this.total_1_10=0,this.total_11_20=0,this.total_21_max=0,Object.entries(r).forEach((([e,t])=>{const a=parseInt(e);a>=1&&a<=10?this.total_1_10+=t:a>=11&&a<=20?this.total_11_20+=t:a>=21&&(this.total_21_max+=t)})),this.total_1_10=this.formatAmount(this.total_1_10),this.total_11_20=this.formatAmount(this.total_11_20),this.total_21_max=this.formatAmount(this.total_21_max),t("log","at components/MonthlyStats.vue:183","ç»Ÿè®¡ç»“æœ:",{workDays:this.workDays,totalRecords:this.totalRecords,dailyAverage:this.dailyAverage,maxDaily:this.maxDaily,total_1_10:this.total_1_10,total_11_20:this.total_11_20,total_21_max:this.total_21_max})}catch(e){t("error","at components/MonthlyStats.vue:194","è®¡ç®—ç»Ÿè®¡å¤±è´¥:",e),this.workDays=0,this.dailyAverage="0",this.maxDaily="0",this.totalRecords=0,this.total_1_10="0",this.total_11_20="0",this.total_21_max="0"}},closeStats(){this.$emit("close")}}},[["render",function(t,a,s,o,r,i){return s.showStats?(e.openBlock(),e.createElementBlock("view",{key:0,class:"stats-container"},[e.createElementVNode("view",{class:"stats-card"},[e.createElementVNode("view",{class:"stats-header"},[e.createElementVNode("view",{class:"stats-title"},"æœ¬æœˆç»Ÿè®¡"),e.createElementVNode("view",{class:"close-btn",onClick:a[0]||(a[0]=(...e)=>i.closeStats&&i.closeStats(...e))},"Ã—")]),e.createElementVNode("view",{class:"stats-grid"},[e.createElementVNode("view",{class:"stat-item"},[e.createElementVNode("view",{class:"stat-label"},"å·¥ä½œå¤©æ•°"),e.createElementVNode("view",{class:"stat-value"},e.toDisplayString(r.workDays),1)]),e.createElementVNode("view",{class:"stat-item"},[e.createElementVNode("view",{class:"stat-label"},"æ—¥å‡æ”¶å…¥"),e.createElementVNode("view",{class:"stat-value"},"Â¥"+e.toDisplayString(r.dailyAverage),1)]),e.createElementVNode("view",{class:"stat-item"},[e.createElementVNode("view",{class:"stat-label"},"æœ€é«˜æ—¥æ”¶å…¥"),e.createElementVNode("view",{class:"stat-value"},"Â¥"+e.toDisplayString(r.maxDaily),1)]),e.createElementVNode("view",{class:"stat-item"},[e.createElementVNode("view",{class:"stat-label"},"æ€»è®°å½•æ•°"),e.createElementVNode("view",{class:"stat-value"},e.toDisplayString(r.totalRecords),1)])]),e.createElementVNode("view",{class:"stat-item"},[e.createElementVNode("view",{class:"stat-label2"},"æœ¬æœˆ1å·åˆ°10å·æ”¶å…¥æ€»å’Œ"),e.createElementVNode("view",{class:"stat-value"},"Â¥"+e.toDisplayString(r.total_1_10),1)]),e.createElementVNode("view",{class:"stat-item"},[e.createElementVNode("view",{class:"stat-label2"},"æœ¬æœˆ11å·åˆ°21å·æ”¶å…¥æ€»å’Œ"),e.createElementVNode("view",{class:"stat-value"},"Â¥"+e.toDisplayString(r.total_11_20),1)]),e.createElementVNode("view",{class:"stat-item"},[e.createElementVNode("view",{class:"stat-label2"},"æœ¬æœˆ21å·åˆ°æœˆåº•æ”¶å…¥æ€»å’Œ"),e.createElementVNode("view",{class:"stat-value"},"Â¥"+e.toDisplayString(r.total_21_max),1)])])])):e.createCommentVNode("",!0)}],["__scopeId","data-v-68f97db1"]])},data:()=>({currentYear:(new Date).getFullYear(),currentMonth:(new Date).getMonth()+1,totalIncome:0,showStats:!1,dbReady:!1}),onLoad(){s().then((()=>{this.dbReady=!0,this.loadData()})).catch((e=>{t("error","at pages/index/index.vue:68","Database initialization failed:",e),uni.showToast({title:"æ•°æ®åº“åˆå§‹åŒ–å¤±è´¥",icon:"none",duration:2e3})}))},onShow(){t("log","at pages/index/index.vue:78","=== ä¸»é¡µæ˜¾ç¤º ==="),this.calculateTotalIncome()},methods:{formatAmount(e){const t=parseFloat(e);return Number.isInteger(t)?t.toString():t.toFixed(3).replace(/\.?0+$/,"")},async loadData(){if(!this.dbReady)return t("log","at pages/index/index.vue:91","æ•°æ®åº“æœªå°±ç»ª"),void(this.totalIncome="0");try{const e=`${this.currentYear}-${String(this.currentMonth).padStart(2,"0")}-01`.trim(),s=new Date(this.currentYear,this.currentMonth,0).getDate(),o=`${this.currentYear}-${String(this.currentMonth).padStart(2,"0")}-${String(s).padStart(2,"0")}`.trim();t("log","at pages/index/index.vue:103","startDate:",e),t("log","at pages/index/index.vue:104","endDate:",o);const r=await a.getWorkRecordsByDateRange(e,o);t("log","at pages/index/index.vue:109","æŸ¥è¯¢åˆ°çš„è®°å½•æ˜¯ï¼š",JSON.stringify(r));const i=r.reduce(((e,t)=>e+parseFloat(t.total||0)),0);this.totalIncome=this.formatAmount(i),t("log","at pages/index/index.vue:116","æœ¬æœˆæ€»æ”¶å…¥:",this.totalIncome)}catch(e){t("error","at pages/index/index.vue:119","è®¡ç®—æœ¬æœˆæ”¶å…¥å¤±è´¥:",e),this.totalIncome="0"}},calculateTotalIncome(){this.loadData()},goToRecord(){uni.navigateTo({url:"/pages/record/record"})},goToHistory(){uni.navigateTo({url:"/pages/history/history"})},async testDemo(){uni.showToast({title:"æœ¬äº§å“ä»…ä½œä¸ºæµ‹è¯•ä¾›å†…éƒ¨ä½¿ç”¨\n\nå¦‚éœ€æ–°å¢åŠŸèƒ½è¯·è”ç³» é‡‘å…°èŠå¥³å£«",icon:"none",duration:4e3})}}},[["render",function(t,a,s,o,r,i){const n=e.resolveComponent("MonthlyStats");return e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("view",{class:"safe-area"},[e.createElementVNode("view",{class:"header-section"},[e.createElementVNode("view",{class:"title"},"å·¥ä½œè®°å½•"),e.createElementVNode("view",{class:"subtitle"},e.toDisplayString(r.currentYear)+"å¹´ "+e.toDisplayString(r.currentMonth)+"æœˆ",1)]),e.createElementVNode("view",{class:"main-card"},[e.createElementVNode("view",{class:"amount-display"},[e.createElementVNode("view",{class:"label"},"æœ¬æœˆæ”¶å…¥"),e.createElementVNode("view",{class:"amount"},"Â¥"+e.toDisplayString(r.totalIncome),1)])]),e.createElementVNode("view",{class:"action-grid"},[e.createElementVNode("view",{class:"action-item primary",onClick:a[0]||(a[0]=(...e)=>i.goToRecord&&i.goToRecord(...e))},[e.createElementVNode("view",{class:"icon"},"âœï¸"),e.createElementVNode("view",{class:"text"},"è®°å½•")]),e.createElementVNode("view",{class:"action-item secondary",onClick:a[1]||(a[1]=(...e)=>i.goToHistory&&i.goToHistory(...e))},[e.createElementVNode("view",{class:"icon"},"ğŸ“Š"),e.createElementVNode("view",{class:"text"},"å†å²")]),e.createElementVNode("view",{class:"action-item accent",onClick:a[2]||(a[2]=e=>r.showStats=!0)},[e.createElementVNode("view",{class:"icon"},"ğŸ“ˆ"),e.createElementVNode("view",{class:"text"},"ç»Ÿè®¡")]),e.createElementVNode("view",{class:"action-item accent",onClick:a[3]||(a[3]=(...e)=>i.testDemo&&i.testDemo(...e))},[e.createElementVNode("view",{class:"text"},"å…¶ä»–è¯´æ˜")])])]),e.createVNode(n,{year:r.currentYear,month:r.currentMonth,"show-stats":r.showStats,onClose:a[4]||(a[4]=e=>r.showStats=!1)},null,8,["year","month","show-stats"])])}],["__scopeId","data-v-aeb58dc7"]]);const i=o({data(){return{date:this.getTodayDate(),quantity:"",unitPrice:"",quickPrices:[.65,.7,.8,.85,.9,1,1.5],dbReady:!1,isSaving:!1}},onLoad(){s().then((()=>{this.dbReady=!0})).catch((e=>{t("error","at pages/record/record.vue:96","Database initialization failed:",e),uni.showToast({title:"æ•°æ®åº“åˆå§‹åŒ–å¤±è´¥",icon:"none",duration:2e3})}))},computed:{totalAmount(){return this.quantity&&this.unitPrice&&!isNaN(this.quantity)&&!isNaN(this.unitPrice)?(parseFloat(this.quantity)*parseFloat(this.unitPrice)).toFixed(2):"0.00"},canSave(){return this.quantity&&this.unitPrice&&parseFloat(this.quantity)>0&&parseFloat(this.unitPrice)>0}},methods:{getTodayDate(){const e=new Date;return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`},formatDisplayDate(e){const t=new Date(e);return`${t.getMonth()+1}æœˆ${t.getDate()}æ—¥`},onDateChange(e){this.date=e.detail.value},handleQuantityInput(e){this.quantity=e.detail.value},handlePriceInput(e){this.unitPrice=e.detail.value},saveRecord(){if(!0!==this.dbReady||this.isSaving)return;if(this.isSaving)return;this.isSaving=!0;const e={date:this.date,quantity:parseFloat(this.quantity),unitPrice:parseFloat(this.unitPrice),total:parseFloat(this.totalAmount)};a.insertWorkRecord(e).then((()=>{uni.showToast({title:"ä¿å­˜æˆåŠŸ",icon:"success",duration:1500}),setTimeout((()=>{uni.navigateBack()}),1500)})).catch((e=>{t("error","at pages/record/record.vue:170","ä¿å­˜è®°å½•å¤±è´¥:",e),uni.showToast({title:"ä¿å­˜å¤±è´¥",icon:"none",duration:2e3}),this.isSaving=!1}))},goBack(){uni.navigateBack()},selectQuickPrice(e){this.unitPrice=e.toString()}}},[["render",function(t,a,s,o,r,i){return e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("view",{class:"safe-area"},[e.createElementVNode("view",{class:"header-section"},[e.createElementVNode("button",{class:"back-btn",onClick:a[0]||(a[0]=(...e)=>i.goBack&&i.goBack(...e))},"â†"),e.createElementVNode("view",{class:"title"},"è®°å½•å·¥ä½œ")]),e.createElementVNode("view",{class:"form-container"},[e.createElementVNode("view",{class:"form-group"},[e.createElementVNode("label",{class:"form-label"},"æ—¥æœŸ"),e.createElementVNode("picker",{mode:"date",value:r.date,onChange:a[1]||(a[1]=(...e)=>i.onDateChange&&i.onDateChange(...e)),class:"date-picker"},[e.createElementVNode("view",{class:"picker-display"},e.toDisplayString(i.formatDisplayDate(r.date)),1)],40,["value"])]),e.createElementVNode("view",{class:"form-group"},[e.createElementVNode("label",{class:"form-label"},"å·¥ä½œæ•°é‡"),e.createElementVNode("input",{type:"number",value:r.quantity,onInput:a[2]||(a[2]=(...e)=>i.handleQuantityInput&&i.handleQuantityInput(...e)),placeholder:"è¯·è¾“å…¥æ•°é‡",class:"modern-input","confirm-type":"done","cursor-spacing":"20","adjust-position":"true","hold-keyboard":"true"},null,40,["value"])]),e.createElementVNode("view",{class:"form-group"},[e.createElementVNode("label",{class:"form-label"},"å•ä»·ï¼ˆå…ƒï¼‰"),e.createElementVNode("input",{type:"digit",value:r.unitPrice,onInput:a[3]||(a[3]=(...e)=>i.handlePriceInput&&i.handlePriceInput(...e)),placeholder:"è¯·è¾“å…¥å•ä»·",class:"modern-input","confirm-type":"done","cursor-spacing":"20","adjust-position":"true","hold-keyboard":"true"},null,40,["value"]),e.createElementVNode("view",{class:"quick-price-chips"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(r.quickPrices,(t=>(e.openBlock(),e.createElementBlock("view",{key:t,class:"price-chip",onClick:e=>i.selectQuickPrice(t)},[e.createElementVNode("text",{class:"price-chip-text"},e.toDisplayString(t),1)],8,["onClick"])))),128))])]),e.createElementVNode("view",{class:"summary-card"},[e.createElementVNode("view",{class:"summary-label"},"é¢„è®¡æ”¶å…¥"),e.createElementVNode("view",{class:"summary-amount"},"Â¥"+e.toDisplayString(i.totalAmount),1)]),e.createElementVNode("view",{class:"action-section"},[e.createElementVNode("button",{class:e.normalizeClass(["save-btn",{disabled:!i.canSave||r.isSaving}]),onClick:a[4]||(a[4]=(...e)=>i.saveRecord&&i.saveRecord(...e)),disabled:!i.canSave||r.isSaving},[e.createElementVNode("view",{class:"btn-text"},"ä¿å­˜è®°å½•")],10,["disabled"])])])])])}],["__scopeId","data-v-80e61689"]]);const n=o({data:()=>({filterMode:"month",selectedYear:(new Date).getFullYear(),selectedMonth:(new Date).getMonth()+1,allRecords:[],currentTotal:0,dbReady:!1,loading:!1}),computed:{groupedRecords(){const e={};this.allRecords.forEach((t=>{const a=t.date;e[a]||(e[a]=[]),e[a].push(t)}));const t={};return Object.keys(e).sort(((e,t)=>new Date(t)-new Date(e))).forEach((a=>{t[a]=e[a]})),t}},watch:{selectedYear(){this.loadRecords()},selectedMonth(){this.loadRecords()},filterMode(){this.loadRecords()}},onLoad(){s().then((()=>{this.dbReady=!0,this.loadRecords()})).catch((e=>{t("error","at pages/history/history.vue:127","Database initialization failed:",e),this.allRecords=[]}))},onShow(){this.loadRecords()},methods:{formatAmount(e){const t=parseFloat(e);return Number.isInteger(t)?t.toString():t.toFixed(3).replace(/\.?0+$/,"")},async loadRecords(){if(t("log","at pages/history/history.vue:144","=== åŠ è½½å†å²è®°å½• ==="),!this.dbReady)return t("log","at pages/history/history.vue:147","æ•°æ®åº“æœªå°±ç»ª"),this.allRecords=[],void(this.currentTotal=0);try{let e,s;if(this.loading=!0,"year"===this.filterMode)e=`${this.selectedYear}-01-01`,s=`${this.selectedYear}-12-31`;else{const t=new Date(this.selectedYear,this.selectedMonth,0).getDate();e=`${this.selectedYear}-${String(this.selectedMonth).padStart(2,"0")}-01`,s=`${this.selectedYear}-${String(this.selectedMonth).padStart(2,"0")}-${t}`}t("log","at pages/history/history.vue:168","æŸ¥è¯¢æ—¥æœŸèŒƒå›´:",e,"è‡³",s);const o=await a.getWorkRecordsByDateRange(e,s);t("log","at pages/history/history.vue:172","æŸ¥è¯¢å®Œæˆï¼Œè®°å½•æ•°é‡:",o.length),this.allRecords=o,this.calculateCurrentTotal(),this.loading=!1}catch(e){t("error","at pages/history/history.vue:178","Error loading records:",e),this.allRecords=[],this.currentTotal=0,this.loading=!1}},calculateCurrentTotal(){t("log","at pages/history/history.vue:185","=== è®¡ç®—å½“å‰æ€»è®¡ ==="),t("log","at pages/history/history.vue:186","å½“å‰è®°å½•æ•°é‡:",this.allRecords.length,"æ¡");const e=this.allRecords.reduce(((e,t)=>e+parseFloat(t.total)),0);this.currentTotal=this.formatAmount(e),t("log","at pages/history/history.vue:193","è®¡ç®—å‡ºçš„æ€»è®¡:",this.currentTotal)},onYearChange(e){this.selectedYear=parseInt(e.detail.value)},onMonthChange(e){this.selectedMonth=parseInt(e.detail.value.split("-")[1])},formatDate(e){const t=new Date(e);return`${t.getMonth()+1}æœˆ${t.getDate()}æ—¥`},getDayTotal(e){return this.formatAmount(e.reduce(((e,t)=>e+parseFloat(t.total)),0))},confirmDelete(e){uni.showModal({title:"ç¡®è®¤åˆ é™¤",content:"ç¡®å®šè¦åˆ é™¤è¿™æ¡è®°å½•å—ï¼Ÿ",success:t=>{t.confirm&&this.deleteRecord(e)}})},async deleteRecord(e){t("log","at pages/history/history.vue:222","=== åˆ é™¤è®°å½• ===");try{t("log","at pages/history/history.vue:225","è°ƒç”¨æ•°æ®åº“åˆ é™¤..."),await a.deleteWorkRecord(e),t("log","at pages/history/history.vue:227","æ•°æ®åº“åˆ é™¤æˆåŠŸï¼Œé‡æ–°åŠ è½½è®°å½•..."),await this.loadRecords(),uni.showToast({title:"åˆ é™¤æˆåŠŸ",icon:"success",duration:1500})}catch(s){t("error","at pages/history/history.vue:236","åˆ é™¤è®°å½•å¤±è´¥:",s),t("error","at pages/history/history.vue:237","é”™è¯¯è¯¦æƒ…:",s.message),uni.showToast({title:"åˆ é™¤å¤±è´¥",icon:"none",duration:2e3})}},setFilterMode(e){this.filterMode=e},goBack(){uni.navigateBack()}}},[["render",function(t,a,s,o,r,i){return e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("view",{class:"glass-card"},[e.createElementVNode("view",{class:"header"},[e.createElementVNode("view",{class:"title"},"å†å²è®°å½•")]),e.createElementVNode("view",{class:"filter-section"},[e.createElementVNode("view",{class:"filter-mode"},[e.createElementVNode("view",{class:e.normalizeClass(["mode-btn",{active:"year"===r.filterMode}]),onClick:a[0]||(a[0]=e=>i.setFilterMode("year"))}," å¹´åº¦æŸ¥çœ‹ ",2),e.createElementVNode("view",{class:e.normalizeClass(["mode-btn",{active:"month"===r.filterMode}]),onClick:a[1]||(a[1]=e=>i.setFilterMode("month"))}," æœˆåº¦æŸ¥çœ‹ ",2)]),e.createElementVNode("view",{class:"filter-row"},["year"===r.filterMode?(e.openBlock(),e.createElementBlock("picker",{key:0,mode:"date",fields:"year",value:r.selectedYear.toString(),onChange:a[2]||(a[2]=(...e)=>i.onYearChange&&i.onYearChange(...e))},[e.createElementVNode("view",{class:"picker-btn"},e.toDisplayString(r.selectedYear)+"å¹´",1)],40,["value"])):(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[e.createElementVNode("picker",{mode:"date",fields:"year",value:r.selectedYear.toString(),onChange:a[3]||(a[3]=(...e)=>i.onYearChange&&i.onYearChange(...e))},[e.createElementVNode("view",{class:"picker-btn"},e.toDisplayString(r.selectedYear)+"å¹´",1)],40,["value"]),e.createElementVNode("picker",{mode:"date",fields:"month",value:r.selectedMonth.toString(),onChange:a[4]||(a[4]=(...e)=>i.onMonthChange&&i.onMonthChange(...e))},[e.createElementVNode("view",{class:"picker-btn"},e.toDisplayString(r.selectedMonth)+"æœˆ",1)],40,["value"])],64))]),e.createElementVNode("view",{class:"total-display"},e.toDisplayString("year"===r.filterMode?r.selectedYear+"å¹´":r.selectedYear+"å¹´"+r.selectedMonth+"æœˆ")+"æ€»æ”¶å…¥ï¼šÂ¥"+e.toDisplayString(r.currentTotal),1)]),e.createElementVNode("scroll-view",{class:"records-list","scroll-y":"true"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(i.groupedRecords,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:"record-group"},[e.createElementVNode("view",{class:"date-header"},[e.createElementVNode("view",{class:"date"},e.toDisplayString(i.formatDate(a)),1),e.createElementVNode("view",{class:"day-total"},"å½“æ—¥æ€»é‡‘é¢ï¼šÂ¥"+e.toDisplayString(i.getDayTotal(t)),1)]),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t,(t=>(e.openBlock(),e.createElementBlock("view",{key:t.id,class:"record-item-container"},[e.createElementVNode("view",{class:"record-item"},[e.createElementVNode("view",{class:"record-content"},[e.createElementVNode("view",{class:"record-header"},[e.createElementVNode("view",{class:"header-item"},"æ•°é‡"),e.createElementVNode("view",{class:"header-item"},"å•ä»·"),e.createElementVNode("view",{class:"header-item"},"æ€»å’Œ")]),e.createElementVNode("view",{class:"record-data"},[e.createElementVNode("view",{class:"data-item"},e.toDisplayString(t.quantity),1),e.createElementVNode("view",{class:"data-item"},"Â¥"+e.toDisplayString(i.formatAmount(t.unitPrice)),1),e.createElementVNode("view",{class:"data-item"},"Â¥"+e.toDisplayString(i.formatAmount(t.total)),1)])]),e.createElementVNode("button",{class:"delete-btn",onClick:e=>i.confirmDelete(t.id)},"åˆ é™¤",8,["onClick"])])])))),128)),e.createElementVNode("view",{class:"divider"})])))),128)),0===Object.keys(i.groupedRecords).length?(e.openBlock(),e.createElementBlock("view",{key:0,class:"empty-state"},[e.createElementVNode("view",{class:"empty-text"},e.toDisplayString(r.loading?"åŠ è½½ä¸­...":"æš‚æ— è®°å½•"),1)])):e.createCommentVNode("",!0)]),e.createElementVNode("view",{class:"header"},[e.createElementVNode("button",{class:"back-btn",onClick:a[5]||(a[5]=(...e)=>i.goBack&&i.goBack(...e))},"â†"),e.createElementVNode("view",{class:"title"},"å†å²è®°å½•")])])])}]]);__definePage("pages/index/index",r),__definePage("pages/record/record",i),__definePage("pages/history/history",n);const l={onLaunch:function(){t("log","at App.vue:4","App Launch")},onShow:function(){t("log","at App.vue:7","App Show")},onHide:function(){t("log","at App.vue:10","App Hide")}};const{app:c,Vuex:d,Pinia:u}={app:e.createVueApp(l)};uni.Vuex=d,uni.Pinia=u,c.provide("__globalStyles",__uniConfig.styles),c._component.mpType="app",c._component.render=()=>{},c.mount("#app")}(Vue);
